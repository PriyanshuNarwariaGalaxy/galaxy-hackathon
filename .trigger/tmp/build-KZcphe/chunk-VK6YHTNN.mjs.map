{
  "version": 3,
  "sources": ["../../../src/trigger/providers/fal/adapter.ts"],
  "sourcesContent": ["import { logger, wait } from \"@trigger.dev/sdk/v3\";\nimport { falProviderId, type FalResumePayload, type FalSubmitResult } from \"./types\";\n\n/**\n * fal.ai provider adapter (Phase 3).\n *\n * This adapter is intentionally small and split into:\n * - submit(): create a Trigger waitpoint token and (in the future) submit the job to fal.ai\n * - resume(): wait for the token to be completed (typically by a webhook)\n *\n * NOTE: We do NOT hardcode fal in the orchestrator. Node execution tasks select providers.\n */\n\nexport async function submitFalJob(params: {\n  workflowRunId: string;\n  nodeId: string;\n  // Provider-specific options can be added later (model, endpoint, etc.)\n}): Promise<FalSubmitResult> {\n  // Create a Trigger waitpoint token which becomes the webhook URL.\n  const token = await wait.createToken({\n    timeout: \"10m\",\n    tags: [\n      `provider:${falProviderId}`,\n      `workflowRun:${params.workflowRunId}`,\n      `node:${params.nodeId}`,\n    ],\n  });\n\n  logger.info(\"fal submit: created wait token\", {\n    provider: falProviderId,\n    workflowRunId: params.workflowRunId,\n    nodeId: params.nodeId,\n    tokenId: token.id,\n  });\n\n  /**\n   * TODO (real fal integration):\n   * - call fal.ai to submit the job\n   * - pass `token.url` as webhook callback URL so fal can resume the run by completing the token\n   * - capture provider requestId and return it\n   *\n   * For now we keep this adapter \"production-ready shape\" but without external calls.\n   * You can enable deterministic local runs by setting FAL_MOCK_MODE=1.\n   */\n  if (process.env.FAL_MOCK_MODE === \"1\") {\n    await wait.completeToken(token, { text: \"mock LLM output (fal)\" } satisfies FalResumePayload);\n  }\n\n  return {\n    tokenId: token.id,\n    tokenUrl: token.url,\n    requestId: undefined,\n  };\n}\n\nexport async function resumeFalJob(params: {\n  tokenId: string;\n}): Promise<FalResumePayload> {\n  // Wait for provider to complete the token (e.g., via webhook).\n  // This must run inside a Trigger task context (node task).\n  const output = await wait.forToken<FalResumePayload>(params.tokenId).unwrap();\n  return output;\n}\n\n"],
  "mappings": ";;;;;;;;;;;;;AAAA;AAaA,eAAsB,aAAa,QAIN;AAE3B,QAAM,QAAQ,MAAM,KAAK,YAAY;AAAA,IACnC,SAAS;AAAA,IACT,MAAM;AAAA,MACJ,YAAY,aAAa;AAAA,MACzB,eAAe,OAAO,aAAa;AAAA,MACnC,QAAQ,OAAO,MAAM;AAAA,IACvB;AAAA,EACF,CAAC;AAED,SAAO,KAAK,kCAAkC;AAAA,IAC5C,UAAU;AAAA,IACV,eAAe,OAAO;AAAA,IACtB,QAAQ,OAAO;AAAA,IACf,SAAS,MAAM;AAAA,EACjB,CAAC;AAWD,MAAI,QAAQ,IAAI,kBAAkB,KAAK;AACrC,UAAM,KAAK,cAAc,OAAO,EAAE,MAAM,wBAAwB,CAA4B;AAAA,EAC9F;AAEA,SAAO;AAAA,IACL,SAAS,MAAM;AAAA,IACf,UAAU,MAAM;AAAA,IAChB,WAAW;AAAA,EACb;AACF;AAxCsB;AA0CtB,eAAsB,aAAa,QAEL;AAG5B,QAAM,SAAS,MAAM,KAAK,SAA2B,OAAO,OAAO,EAAE,OAAO;AAC5E,SAAO;AACT;AAPsB;",
  "names": []
}
